---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(infotheo)
library(tidyverse)
library(ggplot2)
library(devtools)
#library(tidyinfostats)
devtools::load_all("..")
set.seed(101)
theme_set(standardPrintOutput::defaultFigureLayout())
```

## Mutual information of continuous versus discrete disctirbutions

Assume a continuous distribution

```{r}
hb = ConditionalDistribution$new()
hb$withDistribution(0.75, LogNormalDistribution$new(mode=12,sd=2), "asymptomatic")
hb$withDistribution(0.25, LogNormalDistribution$new(mode=8,sd=3), "tired")
hb$withDistribution(0.25, LogNormalDistribution$new(mode=4,sd=5), "unwell")
hb$plot(0,20)

```

And another

```{r}
k = ConditionalDistribution$new()
k$withDistribution(0.125, NormalDistribution$new(mean=1,sd=0.5), "unwell")
k$withDistribution(0.75, NormalDistribution$new(mean=2,sd=1), "asymptomatic")
k$withDistribution(0.125, NormalDistribution$new(mean=8,sd=3), "tired")
```

We can use the properties of the underlying distributions to calculate theoretical values for the Mean, Variance and Mutual Information

```{r}
tibble(measure = c("Mean","Variance","Mutual Information"),
hb = c(hb$theoreticalMean(),hb$theoreticalVariance(), hb$theoreticalMI()),
k = c(k$theoreticalMean(),k$theoreticalVariance(),k$theoreticalMI()))
```

We can also generate test data by samplinf from the underlying distributions

```{r}
testData = k$sample(500) %>% mutate(test="k") %>% bind_rows(
  hb$sample(1000) %>% mutate(test="hb")) %>% rename(outcome=y, value=x)

ggplot(testData, aes(fill=outcome, x=value))+geom_histogram(position="dodge", bins=50)+facet_grid(cols=vars(test))
```

And use this sample to estimate the MI using 3 methods.

TODO: Explain the methods.

```{r}
#devtools::load_all("..")
debug(calculateDiscreteContinuousMI_KNN)
testData %>% group_by(test) %>% tidyinfostats::calculateDiscreteContinuousMI(outcome, value, method = "KWindow") %>% rename(I.win=I) %>% left_join(
testData %>% group_by(test) %>% tidyinfostats::calculateDiscreteContinuousMI(outcome, value, method = "SGolay") %>% rename(I.sg=I), by="test") %>% left_join(
testData %>% group_by(test) %>% tidyinfostats::calculateDiscreteContinuousMI(outcome, value, method = "Discrete") %>% rename(I.disc=I), by="test") %>% left_join(
  testData %>% group_by(test) %>% tidyinfostats::calculateDiscreteContinuousMI(outcome, value, method = "KNN") %>% rename(I.knn=I), by="test") %>% left_join(
tibble(test=c("hb","k"),I.theory = c(hb$theoreticalMI(),k$theoreticalMI())), by="test"
)
```


